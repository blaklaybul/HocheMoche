<!DOCTYPE html>
<meta charset="utf-8">
<style>
path {
  stroke: black;
  stroke-width: 0.25px;
  fill: lightgrey;
}
</style>
<body>
<script type="text/javascript" src="d3/d3.v3.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
<script>

var margin = {top: 40, right: 30, bottom: 40, left:30};
var width=1020 - margin.left - margin.right;
var height = 780 - margin.top - margin.bottom;
   

var stations = [];

var projection = d3.geo.conicConformal()
	.parallels([40+40/60,41+2/60])
	.scale(260000)
	.rotate([74,-40 - 45 / 60]);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var path = d3.geo.path().projection(projection);

var zips = svg.append("g").attr("id", "zipPaths");
var stations = svg.append("g").attr("id", "stations");

var text = svg.append("text")
    .attr("y", height/8)
    .attr("text-anchor", "left");

var text2 = svg.append("text")
	    .attr("y", (height/8) + 18)
	    .attr("text-anchor", "left");

var text3 = svg.append("text")
    .attr("y", (height/8) - 30)
    .attr("text-anchor", "left");
	


// load and display the NYC
d3.json("nyc-streets.json", function(error, json) {
    zips.selectAll("path")
              .data(json.features)
              .enter()
              .append("path")
			  //.attr("class", "tracts")
			  .attr("id", function(d){return d.properties.ZIP;})
              .attr("d", path);
});

$.ajax({
    dataType: "jsonp",
    url: 'http://api.citybik.es/citibikenyc.json',
    success: function(data){
        $.each(data,function(){
						
			stations.selectAll("circle") //change back to circle?
			.data(data)
			.enter()
			.append("circle")
			.attr("cx", function(d){return projection([d.lng/1000000, d.lat/1000000])[0];})
			.attr("cy", function(d){return projection([d.lng/1000000, d.lat/1000000])[1];})
			.attr("r",3)
			.style("fill", function(d) {return color(d.bikes);})
			.style("stroke","black")
			.style("stroke-width", 1)
			.on("mouseover", function(){d3.select(this).transition().attr("r",10);})
			.on("mouseout", function(){d3.select(this).transition().attr("r",3);})
			.on("click", function(d){
					text.text("There are " + d.bikes + " bikes available at this station");
					text2.text("And " + d.free + " empty docks");
					text3.text(d.address);
				});
       
		 });
    },
    error: function(){
        console.log("Error",arguments);
    }
});


var color = d3.scale.linear()
    .domain([0, 30])
    .range(["red", "lightgreen"]);

  	
</script>
</body>
</html>
